from smartcard.System import readers
from smartcard.util import toHexString, PACK, toBytes
from Crypto.Cipher import DES
from Crypto.Hash import SHA

#          CLA  INS  P1   P2   Lc  |--------Data------------->
AID =     [0x00,0xA4,0x04,0x00,0x08,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x07]
CLA =     [0xB0]
NAME =    [0xB0,0x01,0x00,0x00,0x04,0x41, 0x6D, 0x69, 0x74]
PRENOM =  [0xB0,0x02,0x00,0x00,0x09,0x43, 0x68, 0x6F, 0x75, 0x64, 0x68, 0x61, 0x72, 0x69]
PIN =     [0xB0,0x03,0x00,0x00,0x06,0x1,0x2,0x3,0x4,0x5,0x6]
MAC =     [0xB0,0x50,0x00,0x00,0x08,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8]
GET_BAL = [0xB0,0x41,0x00,0x00,0x01,0x00]
P1_P2 =   [0x00, 0x00]

class Control:
    def __init__ (self):
        pass

    def connect(self):
        r=readers()
        self.connection=r[0].createConnection()
        self.connection.connect()
        #Selection AID
        self.connection.transmit(AID)

    def send(self, ins, data, size):
        payload = CLA + ins + P1_P2 + size + data
        print("tx:",payload)
        out, sw1, sw2 = self.connection.transmit(payload)
        print("rx:",out)
        #print("")
        return out

    def disconnect(self):
        #Disconnect the reader
        self.connection.disconnect()
